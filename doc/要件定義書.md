### 要件定義書.md

## Google Chromeブックマーク整理アプリケーション 要件定義書

### 1. 概要

#### 1.1. アプリケーションの目的
本アプリケーションは、ユーザーが自身のGoogle Chromeブックマークファイルを読み込み、Webブラウザ上で直感的にブックマークを整理することを目的とする。特に、リンク切れのURLを自動で検出し、不要なブックマークを簡単に選択・一括削除する機能を提供することで、ユーザーのブックマーク管理を効率化する。

#### 1.2. アプリケーションの概要
ユーザーがローカルのブックマークファイルを選択すると、その内容をツリー形式で表示するWebアプリケーション。リンクチェック機能により各ブックマークの有効性を確認し、結果をアイコンで表示する。ユーザーは不要なブックマークをチェックボックスで選択し、整理後のブックマークファイルを別名で保存することができる。

#### 1.3. ターゲットユーザー
日常的にGoogle Chromeを利用し、長年蓄積された大量のブックマークを整理したいと考えているユーザー。

#### 1.4. 前提条件
- 本アプリケーションは、ユーザーのローカルマシン環境でのみ使用する。全ての処理はクライアントサイド（ブラウザ上）で完結し、ブックマーク情報が外部サーバーに送信されることはない。
- 処理対象のファイルは、Google Chromeが生成する`Bookmarks`ファイル（JSON形式）とする。

### 2. システム要件

#### 2.1. システム構成
- **種別:** 静的Webアプリケーション（クライアントサイド完結型）
- **主要技術:** TypeScript, HTML, CSS
- **実行環境:** ローカルマシン上のWebブラウザ
- **デプロイ:** 不要（ローカルのHTMLファイルをブラウザで開くことで実行）

#### 2.2. 動作環境
- **対応ブラウザ:** Google Chrome, Mozilla Firefox, Microsoft Edge の最新バージョン（File System Access APIの互換性を考慮）

### 3. 機能要件

#### 3.1. 機能一覧（開発タスク分割案）
| 機能ID | 機能名 | 概要 |
| :--- | :--- | :--- |
| F-01 | 初期画面表示機能 | アプリケーション起動時に、ファイル選択ボタンと操作ボタンを含む初期画面を表示する。 |
| F-02 | ブックマークファイル選択機能 | 「ブックマークファイルを開く」ボタンクリックで、ファイル選択ダイアログを表示する。 |
| F-03 | ファイル読み込み・検証機能 | 選択されたファイルがJSON形式であり、Chromeブックマークの構造か簡易的に検証する。 |
| F-04 | ブックマークツリー表示機能 | 読み込んだデータを基に、フォルダとブックマークを全て展開したツリー形式で画面に描画する。 |
| F-05 | アイテム選択機能 | 各ブックマークのサイト名の左にチェックボックスを配置し、ユーザーが選択できるようにする。 |
| F-06 | リンク一括チェック機能 | 「確認する」ボタンクリックで、全ブックマークURLの有効性チェック（クロール）を開始する。 |
| F-07 | リンクチェック中の状態表示機能 | リンクチェック処理中、ユーザーに進捗がわかるようローディングインジケーターを表示する。 |
| F-08 | リンクチェック結果表示機能 | URLのレスポンス状態に応じて、各サイト名の右にアイコン（正常/ページなし/その他）を表示する。 |
| F-09 | ページなしアイテムの自動選択機能 | リンクチェックの結果、ページが存在しない（404 Not Found）と判定されたアイテムのチェックボックスを自動でオンにする。 |
| F-10 | 保存ボタン制御機能 | チェックボックスが1つでもオンになると「保存する」ボタンを活性化し、0個の場合は非活性化する。 |
| F-11 | ブックマーク削除データ生成機能 | 「保存する」ボタンクリック時に、チェックがオンの項目をデータ構造から除外する。 |
| F-12 | ブックマークファイル保存機能 | 削除後のデータを新しいブックマークファイルとして、指定の命名規則でユーザーにダウンロードさせる。 |

#### 3.2. 画面構成
| 画面ID | 画面名 | 概要 |
| :--- | :--- | :--- |
| S-01 | ブックマーク管理画面 | アプリケーションの全機能を提供する単一のメイン画面。 |

#### 3.3. 機能詳細

##### 3.3.1. F-01～F-03: ファイル読み込み関連
1.  **初期画面(S-01):** 画面上部に「ブックマークファイルを開く」ボタン、「確認する」ボタン、「保存する」ボタンを配置する。「保存する」ボタンは初期状態で非活性とする。
2.  **ファイル選択(F-02):** ユーザーが「ブックマークファイルを開く」ボタンをクリックすると、ブラウザのファイル選択ダイアログが開く。
3.  **読み込みと検証(F-03):**
    -   ユーザーがファイルを選択すると、アプリケーションはファイルを読み込む。
    -   ファイル内容が有効なJSON形式でない場合や、期待されるキー（例: `roots`）が存在しない場合は、「無効なブックマークファイルです。」というエラーメッセージを表示する。

##### 3.3.2. F-04, F-05: ブックマーク表示と選択
1.  **ツリー表示(F-04):**
    -   読み込みが成功すると、ファイルの内容を解析し、ブックマークツリーを画面に描画する。
    -   フォルダとブックマークは全て展開された状態で表示する（折りたたみなし）。
    -   各ブックマーク項目は「サイト名 (`name`)」のみを表示する。URLの表示やリンクの設定は行わない。
2.  **アイテム選択(F-05):**
    -   各ブックマーク項目のサイト名の左に、チェックボックスを配置する。
    -   チェックボックスの初期状態はすべてオフとする。

##### 3.3.3. F-06～F-09: リンクチェック関連
1.  **実行トリガー(F-06):** ユーザーが「確認する」ボタンをクリックする。
2.  **処理中表示(F-07):** ボタンクリック後、処理が完了するまでローディングインジケーター（例: プログレスバー）を表示し、ユーザーに処理中であることを示す。
3.  **結果表示(F-08):**
    -   アプリケーションは、表示されている全てのブックマークURLに対して非同期でHTTPリクエストを送信する。
    -   レスポンス結果に基づき、各サイト名の右に以下のアイコンを表示する。
        -   **正常なレスポンス (HTTP 2xx):** ニコちゃんマーク (例: 😊)
        -   **ページが存在しない (HTTP 404):** ドクロマーク (例: 💀)
        -   **上記以外のレスポンス (リダイレクト、その他エラー、タイムアウト等):** 疑問符マーク (例: ❓)
4.  **自動選択(F-09):** ページが存在しない（ドクロマーク）と判定されたブックマークは、ユーザーの手間を省くため、対応するチェックボックスを自動的にオンにする。

##### 3.3.4. F-10～F-12: 保存関連
1.  **ボタン制御(F-10):**
    -   ユーザーが手動または自動選択によりチェックボックスを1つでもオンにすると、「保存する」ボタンが活性化（クリック可能）する。
    -   全てのチェックボックスがオフになると、ボタンは非活性化する。
2.  **実行と保存(F-11, F-12):**
    -   ユーザーが活性化された「保存する」ボタンをクリックする。
    -   アプリケーションは、チェックボックスがオンになっている項目を元のブックマークデータ（JSONオブジェクト）から削除する。
    -   処理後のデータをJSON文字列に変換し、「**Bookmarks_YYYYMMDD.json**」（例: `Bookmarks_20250612.json`）というファイル名で、ユーザーにダウンロードさせる。
    -   既存のブックマークファイルの上書きは行わず、新しいファイルをユーザーが手動でChromeにインポートすることを促す。

### 4. 非機能要件

#### 4.1. ユーザビリティ・UI/UX
- **シングルページアプリケーション:** 画面遷移がなく、全ての操作が単一の画面で完結する。
- **フィードバック:** リンクチェックのような時間のかかる処理では、プログレスバーやスピナーを表示し、ユーザーが処理の進行状況を把握できるようにする。
- **エラーハンドリング:** ファイル形式が違う場合や予期せぬエラーが発生した場合は、ユーザーに分かりやすいエラーメッセージを表示する。

#### 4.2. パフォーマンス
- **非同期処理:** 大量のブックマーク（数千件）のリンクチェックを行う際、ブラウザが固まらないよう、全てのHTTPリクエストを非同期で実行する。

#### 4.3. セキュリティ
- **プライバシー:** 全てのファイル処理はユーザーのブラウザ内で完結する。ブックマークファイルやその内容が外部のサーバーにアップロードされたり、送信されたりすることはない。

### 5. 開発プロセス

- 本プロジェクトは**スクラム**フレームワークを用いて開発を進める。
- 機能要件で定義された機能一覧（F-01〜F-12）をベースにプロダクトバックログアイテムを作成し、スプリントごとに開発を行う。